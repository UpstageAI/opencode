@property --reveal-ready {
  syntax: "<number>";
  inherits: true;
  initial-value: 0;
}

[data-component="message-nav"] {
  flex-shrink: 0;
  position: relative;
  z-index: 10;
  height: 100%;
  max-height: calc(100vh - 6rem);
  overflow-y: auto;
  overflow-x: hidden;
  padding: 8px 0 0 8px;
}

[data-slot="message-nav-list"] {
  --is-expanded: 0;
  --reveal-ready: 0;
  --message-nav-item-height: 11px;
  --message-nav-item-width: 24px;
  --message-nav-expanded-width: 240px;
  --message-nav-line-width: 16px;

  list-style: none;
  padding: 4px;
  width: var(--message-nav-item-width);
  box-sizing: border-box;
  display: grid;
  grid-gap: 4px;
  grid-template-rows: repeat(var(--message-nav-items), var(--message-nav-item-height));
  border-radius: var(--radius-md);
  transition-property: background-color, box-shadow, width, grid-template-rows, padding, --reveal-ready;
  transition-duration: 300ms, 300ms, 300ms, 300ms, 300ms, 1s;
  transition-delay: 0ms, 0ms, 0ms, 0ms, 0ms, 280ms;
  transition-timing-function: cubic-bezier(0.32, 0, 0.15, 1);

  &:hover {
    --is-expanded: 1;
    --reveal-ready: 1;
    --message-nav-item-height: 25px;
    --message-nav-item-width: var(--message-nav-expanded-width);

    background-color: var(--surface-raised-stronger-non-alpha);
    box-shadow:
      0 0 0 1px var(--border-weak-base, rgba(17, 0, 0, 0.12)),
      0 1px 2px -1px rgba(19, 16, 16, 0.04),
      0 1px 2px 0 rgba(19, 16, 16, 0.06),
      0 1px 3px 0 rgba(19, 16, 16, 0.08);
  }
}

[data-slot="message-nav-item"] {
  width: 100%;
  height: 100%;
}

[data-slot="message-nav-item-button"] {
  --line-width: var(--message-nav-line-width);
  --line-expanded-width: calc(var(--message-nav-expanded-width) - 16px);

  appearance: none;
  border: none;
  background: none;
  padding: 0 4px;
  margin: 0;
  cursor: pointer;
  position: relative;
  font-family: inherit;
  display: flex;
  align-items: center;
  justify-content: flex-start;
  gap: 8px;
  box-sizing: border-box;
  width: calc(var(--message-nav-item-width) - 8px);
  height: 100%;
  border-radius: var(--radius-xs);
  transition: background-color 0.15s ease;

  &::before {
    content: "";
    display: block;
    flex-shrink: 0;
    /* Width expands first, then scaleX shrinks it to the right */
    width: 100%;
    height: 3px;
    position: absolute;
    pointer-events: none;
    left: 4px;
    top: 50%;
    /* scaleX shrinks from 1 to 0, collapsing toward the right (revealing left side) */
    transform: scaleX(.66) translateY(-50%) scaleX(calc(1 - var(--reveal-ready)));
    transform-origin: 100% 50%; /* Anchor on right, line collapses to the right */
    background-color: var(--icon-weak-base);
    transition-property: width, background-color, transform;
    transition-duration: 300ms, 300ms, 400ms;
    transition-timing-function: cubic-bezier(0.32, 0, 0.15, 1);
  }

  &:hover {
    background-color: var(--surface-base-hover);
  }

  &[data-active="true"] {
    --line-width: 24px;

    &::before {
      background-color: var(--icon-strong-base);
    }

    [data-slot="message-nav-item-title-inner"] {
      color: var(--text-strong);
    }
  }
}

[data-slot="message-nav-item-title"] {
  position: relative;
  display: flex;
  align-items: center;
  min-width: 0;
  flex: 1;
  opacity: var(--reveal-ready);
  transition: opacity 200ms cubic-bezier(0.32, 0, 0.15, 1);
  scrollbar-width: none;
  -ms-overflow-style: none;

  &::-webkit-scrollbar {
    display: none;
  }
}

[data-slot="message-nav-item-title-inner"] {
  --factor: 5;
  --spacing: 4px;
  --avg-width: 12px;
  --total-width: 0px;
  --virtual-width: var(--total-width);
  --ramp-distance: calc(var(--avg-width) * var(--factor));
  --reveal-pos: calc(var(--reveal-ready) * var(--virtual-width));

  perspective: 1000px;
  font-size: 12px;
  transform-style: preserve-3d;
  line-height: 25px;
  padding-right: 4px;
  color: var(--text-base);
  white-space: nowrap;
  display: inline-flex;
  align-items: center;
  transition: transform 0.4s cubic-bezier(0.32, 0, 0.15, 1);
}

/* Character spans for rotate effect */
[data-slot="message-nav-char"] {
  --progress: clamp(0, calc((var(--reveal-pos) - var(--char-left, 0px) - var(--spacing)) / var(--ramp-distance)), 1);

  display: inline-block;
  transition: transform 300ms cubic-bezier(0.32, 0, 0.15, 1);
  transform: rotateX(calc(-90deg * (1 - var(--progress)))) skewY(calc(15deg * (1 - var(--progress))));
  transform-origin: 50% 45%;
}

[data-slot="message-nav-item-diff-changes"] {
  font-family: var(--font-family-mono);
  font-feature-settings: var(--font-family-mono--font-feature-settings);
  font-size: 11px;
  font-style: normal;
  font-weight: 500;
  margin-left: auto;
  display: flex;
  gap: 2px;
  flex-shrink: 0;
  opacity: var(--reveal-ready);
  transition: opacity 200ms cubic-bezier(0.32, 0, 0.15, 1);
  transition-delay: calc(var(--reveal-ready) * 50ms);
}

[data-slot="message-nav-item-additions"] {
  color: var(--text-diff-add-base);
  display: inline-block;
  vertical-align: top;

  &::before {
    content: "+";
    font: inherit;
    display: inline-block;
  }
}

[data-slot="message-nav-item-deletions"] {
  color: var(--text-diff-delete-base);
  display: inline-block;
  vertical-align: top;

  &::before {
    content: "-";
    display: inline-block;
    font: inherit;
  }
}
